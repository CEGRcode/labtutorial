<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Planemo - PughLab-guides</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Planemo";
    var mkdocs_page_input_path = "planemo.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> PughLab-guides</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../galaxy/">Galaxy</a>
	    </li>
          
            <li class="toctree-l1 current">
		
    <a class="current" href="./">Planemo</a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#planemo">Planemo</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#pre-install">Pre-Install</a></li>
        
            <li><a class="toctree-l3" href="#install">Install</a></li>
        
            <li><a class="toctree-l3" href="#usage">Usage</a></li>
        
            <li><a class="toctree-l3" href="#example">Example</a></li>
        
        </ul>
    

    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../pegr/">PEGR</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../grails/">Grails</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../debug/">Debug</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../FAQ/">FAQ</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">PughLab-guides</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Planemo</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/CEGRcode/labtutorial/edit/master/docs/planemo.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="planemo">Planemo<a class="headerlink" href="#planemo" title="Permanent link">#</a></h1>
<h2 id="pre-install">Pre-Install<a class="headerlink" href="#pre-install" title="Permanent link">#</a></h2>
<p>Install <a href="https://www.anaconda.com/download">anaconda</a> (locally) on your machine.</p>
<p>Install wget:</p>
<ul>
<li><code>$ brew install wget</code> - (mac)</li>
<li><code>$ sudo apt-get install wget</code> - (others)</li>
</ul>
<p>Install virtual environment:</p>
<ul>
<li><code>$ brew install virtualenv</code> - (mac)</li>
<li><code>$ sudo apt-get install virtualenv</code> - (others)</li>
</ul>
<p>NOTE: make sure <a href="https://galaxyproject.org/admin/get-galaxy/">local galaxy</a> is installed.
Couple of dependencies are installed and you should see the galaxy running at localhost:8080</p>
<p>Install pip:</p>
<ul>
<li><code>$ brew install pip</code> - (mac)</li>
<li><code>$ sudo apt-get install pip</code> - (others)</li>
</ul>
<h2 id="install">Install<a class="headerlink" href="#install" title="Permanent link">#</a></h2>
<p>Install planemo:</p>
<ul>
<li><code>$ virtualenv .venv; . .venv/bin/activate</code></li>
<li><code>$ pip install â€“-upgrade pip # Upgrade pip if needed.</code></li>
<li><code>$ pip install planemo</code></li>
</ul>
<p>Basic <a href="https://planemo.readthedocs.io/en/latest/installation.html">tutorial</a></p>
<h2 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link">#</a></h2>
<p>This guide assumes that you have already installed Planemo and have a directory with one or more Galaxy tool with input &amp; output files.</p>
<h3 id="1-init">1) Init<a class="headerlink" href="#1-init" title="Permanent link">#</a></h3>
<p>Create galaxy tool wrapper using the init command.</p>
<ul>
<li><code>$ planemo init</code></li>
</ul>
<p>CONGRATULATIONS, YOU HAVE SUCCESSFULLY SET UP THE PLANEMO TOOL!</p>
<p>Example:</p>
<pre><code>$ planemo tool_init
                --id 'id' \
                --name 'Name of the file' \
                --description 'Description (optional)' \
                --requirement software_version@2.2 \
                --example_command 'input &amp; output command' \
                --example_input input_file \
                --example_output output_file \
                --test_case \
                --cite_url 'https://url' \
                --help_from_command 'id'
</code></pre>
<p>NOTE: Planemo is unable to partially initialize, for example if your xml file is missing "citation" section during linting, in order to add it from the command line you need to initialize the entire wrapper. So it's really for creating a new wrapper not modifying an existing one.</p>
<h3 id="2-lint">2) Lint<a class="headerlink" href="#2-lint" title="Permanent link">#</a></h3>
<p>Planemo can check review tool for XML validity, syntax errors, and compliance with IUC best practices using the lint (l) command.</p>
<ul>
<li><code>$ planemo lint</code> # same as planemo lint</li>
<li><code>$ planemo lint --help</code></li>
</ul>
<p>You will also see the test-data directory generated for testing.</p>
<h3 id="3-test">3) Test<a class="headerlink" href="#3-test" title="Permanent link">#</a></h3>
<p>The test command can be used to test the functionality of tool(s). In other words, it checks if the xml file works as supposed to.</p>
<ul>
<li><code>$ planemo test</code> - test all the xml files in the current directory</li>
<li><code>$ planemo test --galaxy_root=../galaxy wrapper.xml</code> - with optional parameters and specify file(s) to run the test.</li>
</ul>
<p>By default, planemo will search parent directories to see if any is a Galaxy instance.</p>
<p>Important note: if you specify --galaxy_root folder, reverting it back might be difficult since the  planemo virtual environment path is set up to the galaxy directory. You can try to force planemo to download a disposable instance with the --install_galaxy flag.</p>
<ul>
<li>Ex: <code>$ planemo test --install_galaxy wrapper.xml</code></li>
</ul>
<h3 id="4-serve">4) Serve<a class="headerlink" href="#4-serve" title="Permanent link">#</a></h3>
<p>After passing the test we can open Galaxy with the serve (or with s).</p>
<pre><code>$ planemo s
...
serving on http://127.0.0.1:8086
</code></pre>
<h2 id="example">Example<a class="headerlink" href="#example" title="Permanent link">#</a></h2>
<h3 id="1-seqtk">1) Seqtk<a class="headerlink" href="#1-seqtk" title="Permanent link">#</a></h3>
<p>Use conda to install Seqtk:</p>
<ul>
<li><code>$ conda install --force --yes -c bioconda seqtk=1.2</code></li>
<li><code>$ seqtk seq</code> - check if seqtk is installed</li>
</ul>
<p>Download an example FASTQ file</p>
<ul>
<li><code>$ wget https://raw.githubusercontent.com/galaxyproject/galaxy-test-data/master/2.fastq</code></li>
<li><code>$ seqtk seq -A 2.fastq &gt; 2.fasta</code></li>
<li><code>$ cat 2.fasta</code></li>
</ul>
<p>If you are unable to download or execute the wget command, simply copy &amp; paste the text and save as both 2.fastq and 2.fasta and continue along the steps:</p>
<pre><code>&gt;EAS54_6_R1_2_1_413_324
CCCTTCTTGTCTTCAGCGTTTCTCC
&gt;EAS54_6_R1_2_1_540_792
TTGGCAGGCCAAGGCCGATGGATCA
&gt;EAS54_6_R1_2_1_443_348
GTTGCTTCTGGCGTGGGTGGGGGGG
</code></pre>
<p>Run the following command to generate seqtk_seq.xml file. These contain minimal requirements for the xml file.</p>
<pre><code>$ planemo tool_init --force \
              --id 'seqtk_seq' \
              --name 'Convert to FASTA (seqtk)' \
              --requirement seqtk@1.2 \
              --example_command 'seqtk seq -a 2.fastq &gt; 2.fasta' \
              --example_input 2.fastq \
              --example_output 2.fasta \
              --test_case \
              --cite_url 'https://github.com/lh3/seqtk' \
              --help_from_command 'seqtk seq'
</code></pre>
<p>Explanation of each command options (more <a href="https://planemo.readthedocs.io/en/latest/commands.html">here</a>):</p>
<pre><code>id                      Short identifier for new tool (no whitespace).
force                   Overwrite existing tool if present.
name                    Name for new tool.
description             Short description for new tool.
requirement             Name of the package.  requirements will be set using Bioconda.
example_command         Example to command with paths to build Cheetah template from. Must follow with --example_input and --example_output.
example_input           Replace input file.
example_output          Replace output file.
test_case               Generate test-data directory with tool test cases from the supplied example.
cite_url                Supply a URL for citation.
help_from_command       Auto populate help from supplied command.
</code></pre>
<p>Type the following in the same directory where your seqtk.xml is located.</p>
<ul>
<li>
<p><code>$ planemo lint seqtk.xml</code></p>
</li>
<li>
<p>Tip: Planemo lint command only checks if the syntax is correct, so if you are unable to pass the lint using planemo, check to make sure the above requirements are satisfied. If output says "Failed linting" at the end, see the current <a href="https://github.com/galaxyproject/planemo/#issues">github issues</a>.</p>
</li>
</ul>
<p>Successful output <a href="../image/output.jpg">here</a></p>
<p>Functionality test</p>
<pre><code>$ planemo t
</code></pre>
<p>Output:</p>
<pre><code>$ planemo t
...
All 1 test(s) executed passed.
seqtk_seq[0]: passed
</code></pre>
<p>If error occurs, refer to the error report page on GitHub.</p>
<h3 id="2-getrandombed">2) getRandomBed<a class="headerlink" href="#2-getrandombed" title="Permanent link">#</a></h3>
<p>Download getRandomBed.py tool:</p>
<p>Use the planemo commands to generate the xml file getRandomBed.xml</p>
<p>Solution:</p>
<pre><code>planemo tool_init --force \
                --id 'getRandomBed' \
                --name 'Random Bed' \
                --requirement python@2.7.14 \
                --example_command '$__tool_directory__/genRandomBed.py $inputBed' \
                --example_input inputBed \
                --example_output randomBed \
                --test_case \
                --cite_url 'http://www.pughlab.psu.edu/' \
                --help_from_command 'getRandomBed'
</code></pre>
<h3 id="3-toolexamplepl">3) toolExample.pl<a class="headerlink" href="#3-toolexamplepl" title="Permanent link">#</a></h3>
<p>Consider the following Perl script.</p>
<pre><code>    #!/usr/bin/perl -w

    # usage : perl toolExample.pl &lt;FASTA file&gt; &lt;output file&gt;

    open (IN, "&lt;$ARGV[0]");
    open (OUT, "&gt;$ARGV[1]");
    while (&lt;IN&gt;) {
        chop;
        if (m/^&gt;/) {
            s/^&gt;//;
            if ($. &gt; 1) {
                print OUT sprintf("%.3f", $gc/$length) . "\n";
            }
            $gc = 0;
            $length = 0;
        } else {
            ++$gc while m/[gc]/ig;
            $length += length $_;
        }
    }
    print OUT sprintf("%.3f", $gc/$length) . "\n";
    close( IN );
    close( OUT ); #__end__
</code></pre>
<p>Create an xml file for the script with an output as follows:</p>
<pre><code>&lt;tool id="gc_content" name="Compute GC content"&gt;
  &lt;description&gt;for each sequence in a file&lt;/description&gt;
  &lt;command&gt;perl $__tool_directory__/gc_content.pl $input output.tsv&lt;/command&gt;
  &lt;inputs&gt;
    &lt;param format="fasta" name="input" type="data" label="Source file"/&gt;
  &lt;/inputs&gt;
  &lt;outputs&gt;
    &lt;data format="tabular" name="output" from_work_dir="output.tsv" /&gt;
  &lt;/outputs&gt;
  &lt;help&gt;
This tool computes GC content from a FASTA file.
  &lt;/help&gt;
&lt;/tool&gt;
</code></pre>
<p>Solution:</p>
<pre><code>planemo tool_init --force \
                    --id 'gc_content' \
                    --name 'Compute GC content' \
                    --description 'for each sequence in a file' \
                    --example_command 'perl $__tool_directory__/gc_content.pl $input output.tsv' \
                    --example_input input.fasta \
                    --example_output output.tsv \
                    --help 'This tool computes GC content from a FASTA file.'
</code></pre>
<p>Q: Will this pass the planemo lint test?</p>
<p>A: No it is missing the following parameters:</p>
<pre><code>                test_case, requirement, citation, help_from_command
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../pegr/" class="btn btn-neutral float-right" title="PEGR">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../galaxy/" class="btn btn-neutral" title="Galaxy"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/CEGRcode/labtutorial/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../galaxy/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../pegr/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
