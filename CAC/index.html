<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<title>CAC - PughLab-guides</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<meta name="generator" content="mkdocs-1.1.2, mkdocs-gitbook-1.0.7">

<link rel="shortcut icon" href="../images/favicon.ico" type="image/x-icon">
<meta name="HandheldFriendly" content="true"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta rel="next" href="" />
<link href="../css/style.min.css" rel="stylesheet"> 
</head>

<body>
<div class="book">
<div class="book-summary">

<nav role="navigation">
<ul class="summary">
<li>
<a href=".." target="_blank" class="custom-link">PughLab-guides</a>
</li>
<li class="divider"></li>
<li class="chapter" data-path="">
<a href="..">Home</a>
<li class="chapter" data-path="galaxy/">
<a href="../galaxy/">Galaxy</a>
<li class="chapter" data-path="planemo/">
<a href="../planemo/">Planemo</a>
<li class="chapter active" data-path="CAC/">
<a href="./">CAC</a>
<li class="chapter" data-path="Frontend%20Deployment/">
<a href="../Frontend%20Deployment/">Frontend Deployment</a>
<li class="chapter" data-path="Backend%20Deployment/">
<a href="../Backend%20Deployment/">Backend Deployment</a>
<li class="chapter" data-path="pegr/">
<a href="../pegr/">PEGR</a>
<li class="chapter" data-path="labwebsite/">
<a href="../labwebsite/">Lab Websites</a>
<li class="chapter" data-path="FAQ/">
<a href="../FAQ/">FAQ</a>
<li class="divider"></li>



<li><a href="http://www.mkdocs.org">
Published with MkDocs
</a></li>

<li><a href="https://github.com/GitbookIO/theme-default">
Theme by GitBook
</a></li>
</ul>

</nav>

</div> <!-- end of book-summary -->

<div class="book-body">
<div class="body-inner">
<div class="book-header" role="navigation">

<!-- Title -->
<h1>
<i class="fa fa-circle-o-notch fa-spin"></i>
<a href="." ></a>
</h1>

</div> <!-- end of book-header -->

<div class="page-wrapper" tabindex="-1" role="main">
<div class="page-inner">

<section class="normal markdown-section">



<h1 id="cornells-cac-server-setup">Cornell's CAC server setup<a class="headerlink" href="#cornells-cac-server-setup" title="Permanent link">#</a></h1>
<p>Instructions to manually setup Cornell's CAC VM hosting servers.</p>
<table>
<thead>
<tr>
<th>Server Names</th>
<th>Category</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="http://odin.cac.cornell.edu/">odin.cac.cornell.edu</a></td>
<td>Web Production Server</td>
</tr>
<tr>
<td><a href="http://artemis.cac.cornell.edu/">artemis.cac.cornell.edu</a></td>
<td>Web Development Server</td>
</tr>
</tbody>
</table>
<h3 id="enable-the-epel-repository">Enable the EPEL repository<a class="headerlink" href="#enable-the-epel-repository" title="Permanent link">#</a></h3>
<p>EPEL repository consists of packages for tools such as <code>htop</code> and more.</p>
<p>To add the EPEL repository for tool lookup, run:</p>
<pre><code>dnf install https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm
dnf update
dnf install htop
</code></pre>

<h3 id="install-nodejs">Install nodejs<a class="headerlink" href="#install-nodejs" title="Permanent link">#</a></h3>
<pre><code># checking available nodejs versions
$ sudo dnf module list nodejs

# disable defaults
$ sudo dnf module disable nodejs:10

# pick the Latest LTS version
$ sudo dnf module enable nodejs:12

# install and verify version
$ sudo dnf install nodejs
$ node --version
</code></pre>

<blockquote>
<p>reference : <a href="https://www.digitalocean.com/community/tutorials/how-to-install-node-js-on-centos-8">https://www.digitalocean.com/community/tutorials/how-to-install-node-js-on-centos-8</a></p>
</blockquote>
<h3 id="install-mongodb">Install mongodb<a class="headerlink" href="#install-mongodb" title="Permanent link">#</a></h3>
<pre><code>$ sudo nano /etc/yum.repos.d/mongodb-org-4.2.repo

# copy below text into the file

[mongodb-org-4.2]
name=MongoDB Repository
baseurl=https://repo.mongodb.org/yum/redhat/$releasever/mongodb-org/4.2/x86_64/
gpgcheck=1
enabled=1
gpgkey=https://www.mongodb.org/static/pgp/server-4.2.asc

</code></pre>

<pre><code># Install and start the mongod service.
$ sudo yum install -y mongodb-org
$ sudo service mongod start

# Checking installation by bringing up the mongodb prompt.
$ mongo

# You can verify that the mongod process has started successfully
# by checking the contents of the log file at `/var/log/mongodb/mongod.log`
$ sudo less /var/log/mongodb/mongod.log

</code></pre>

<blockquote>
<p>reference: <a href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-red-hat/">https://docs.mongodb.com/manual/tutorial/install-mongodb-on-red-hat/
</a></p>
</blockquote>
<h3 id="install-apache">Install apache<a class="headerlink" href="#install-apache" title="Permanent link">#</a></h3>
<pre><code>$ sudo yum install httpd
$ sudo systemctl start httpd

</code></pre>

<ul>
<li>CentOS 8 has lot of firewall restrictions built in, so to open up ports use the <code>firewall-cmd</code> command.</li>
</ul>
<pre><code>sudo firewall-cmd --zone=public --permanent --add-port 8081/tcp
sudo firewall-cmd --reload

sudo firewall-cmd --zone=public --permanent --add-port 3000/tcp
sudo firewall-cmd --reload
</code></pre>

<blockquote>
<p>Apache reference :<a href="https://linuxize.com/post/how-to-install-apache-on-centos-8/">https://linuxize.com/post/how-to-install-apache-on-centos-8/
</a></p>
<p>Firewall reference: <a href="https://linuxconfig.org/redhat-8-open-and-close-ports">https://linuxconfig.org/redhat-8-open-and-close-ports
</a></p>
</blockquote>
<ul>
<li>Apache needs to read the <code>.htaccess</code> files within the frontend deployment folders available at <code>/var/www/html/&lt;project-folder&gt;</code>.
This is required for resolving routes on the client's side. you can read more <a href="https://create-react-app.dev/docs/deployment/#serving-apps-with-client-side-routing">here</a>. Below are the steps to enable this.</li>
</ul>
<pre><code># stop the apache server
$ sudo service httpd stop

# check the status of your apache server (to check if it is stopped)
$ sudo service httpd status

# edit the httpd (apache's) configuration (usually located at below default install location)
$ cd /etc/httpd/conf/
$ sudo nano httpd.conf
</code></pre>

<ul>
<li>Look for the lines below within the configuration file.</li>
</ul>
<pre><code># Further relax access to the default document root:
&lt;Directory &quot;/var/www/html&quot;&gt;
    #
    # Possible values for the Options directive are &quot;None&quot;, &quot;All&quot;,
    # or any combination of:
    #   Indexes Includes FollowSymLinks SymLinksifOwnerMatch ExecCGI MultiViews
    #
    # Note that &quot;MultiViews&quot; must be named *explicitly* --- &quot;Options All&quot;
    # doesn't give it to you.
    #
    # The Options directive is both complicated and important.  Please see
    # http://httpd.apache.org/docs/2.4/mod/core.html#options
    # for more information.
    #
    Options Indexes MultiViews FollowSymLinks

    #
    # AllowOverride controls what directives may be placed in .htaccess files.
    # It can be &quot;All&quot;, &quot;None&quot;, or any combination of the keywords:
    #   Options FileInfo AuthConfig Limit
    #
    AllowOverride None

    #
    # Controls who can get stuff from this server.
    #
    Require all granted

&lt;/Directory&gt;

</code></pre>

<ul>
<li>Now add these directives into <code>httpd.conf</code> <strong>AFTER</strong> the above directives, to allow apache to read <code>.htaccess</code> in our website's folder. These lines needs to be added for each website you are deploying (for those that are built on react).</li>
</ul>
<pre><code>&lt;Directory /var/www/html/yep&gt;
    Options Indexes FollowSymLinks
    AllowOverride All
    Require all granted
&lt;/Directory&gt;
</code></pre>

<ul>
<li>start the server, your websites now route correctly on the client.</li>
</ul>
<pre><code>sudo service httpd start
</code></pre>

<h3 id="requesting-ssl-certificates-for-the-vms">Requesting SSL certificates for the VMs<a class="headerlink" href="#requesting-ssl-certificates-for-the-vms" title="Permanent link">#</a></h3>
<ul>
<li>Generate a <strong>key</strong> and <strong>csr</strong> file for your server.</li>
</ul>
<pre><code>openssl req -nodes -newkey rsa:2048 -keyout artemis_ssl.key -out artemis_ssl.csr
</code></pre>

<ul>
<li>you will be prompted with a questionnaire. below are <strong>EXAMPLE</strong> answers.</li>
</ul>
<pre><code>Generating a RSA private key
.............................................+++++......+++++

writing new private key to 'artemis_ssl.key'
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----

Country Name (2 letter code) [XX]:US
State or Province Name (full name) []:New York
Locality Name (eg, city) [Default City]:Ithaca
Organization Name (eg, company) [Default Company Ltd]:Cornell University
Organizational Unit Name (eg, section) []:Center for Advanced Computing
Common Name (eg, your name or your server's hostname) []: artemis.cac.cornell.edu
Email Address []:cac-systems@cornell.edu

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:
An optional company name []:
</code></pre>

<ul>
<li>email the resulting <code>myserver.csr</code> file to <code>cac-help@cornell.edu</code>. After a couple of hours or the next day you should receive an ssl cert from them.</li>
</ul>
<h3 id="useful-commands">Useful commands<a class="headerlink" href="#useful-commands" title="Permanent link">#</a></h3>
<ul>
<li>Exporting collections (tables in mongoDB) in a databases as JSON</li>
</ul>
<pre><code>mongoexport --collection=samples --db=yepDB --out=yepSamples-2020-01-01.json
</code></pre>

<ul>
<li>Change Ownership recursively for image assets being served by the API BACKEND. <em>Should be owned by root and set to public access.</em></li>
</ul>
<pre><code>$ sudo chown -R user:group folder
$ sudo chown -R root:root yepImages

# have access to all for the images to show up on the website.
$ sudo chmod -R 755 yepImages
</code></pre>


</section>

</div> <!-- end of page-inner -->
</div> <!-- end of page-wrapper -->

</div> <!-- end of body-inner -->

</div> <!-- end of book-body -->
<script src="../js/main.js"></script>
<script src="../js/gitbook.min.js"></script>
<script src="../js/theme.min.js"></script>
</body>
</html>