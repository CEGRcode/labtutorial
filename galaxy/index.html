<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Galaxy - PughLab-guides</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Galaxy";
    var mkdocs_page_input_path = "galaxy.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> PughLab-guides</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Home</a>
	    </li>
          
            <li class="toctree-l1 current">
		
    <a class="current" href="./">Galaxy</a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#dependencies">Dependencies</a></li>
    

    <li class="toctree-l2"><a href="#installing-galaxy">Installing Galaxy</a></li>
    

    <li class="toctree-l2"><a href="#configuring-galaxy">Configuring Galaxy</a></li>
    

    <li class="toctree-l2"><a href="#adding-custom-genomes">Adding Custom Genomes</a></li>
    

    <li class="toctree-l2"><a href="#importing-chip-exo-workflow">Importing ChIP-exo Workflow</a></li>
    

    <li class="toctree-l2"><a href="#integrating-cegr-output_statistics">Integrating CEGR output_statistics</a></li>
    

    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../planemo/">Planemo</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../pegr/">PEGR</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../grails/">Grails</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../debug/">Debug</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../FAQ/">FAQ</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">PughLab-guides</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Galaxy</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/CEGRcode/labtutorial/edit/master/docs/galaxy.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="dependencies">Dependencies<a class="headerlink" href="#dependencies" title="Permanent link">#</a></h2>
<ul>
<li>Assuming you have installed the required <a href="http://127.0.0.1:8000/#development-tools">development tools for Mac OS</a></li>
<li>Install <a href="http://samtools.sourceforge.net/-Install">samtools</a>.<ul>
<li><code>brew install samtools</code></li>
</ul>
</li>
<li>Install <a href="https://yarnpkg.com/en/docs/install">yarn</a>.<ul>
<li><code>brew install yarn</code></li>
</ul>
</li>
</ul>
<hr />
<h2 id="installing-galaxy">Installing Galaxy<a class="headerlink" href="#installing-galaxy" title="Permanent link">#</a></h2>
<p><em>It is recommended that you clone galaxy to your <code>~/Desktop</code>, so that GALAXY's internal paths are shorter and avoid conda throwing any errors that your path exceeds the maximum characters for tool install paths</em></p>
<p><em>here we are going to work with <code>17.09</code> release of GALAXY.</em></p>
<ul>
<li>Open a <code>terminal</code> and clone GALAXY to your <code>~/Desktop</code>.</li>
</ul>
<pre><code>cd ~/Desktop
git clone -b release_17.09 https://github.com/galaxyproject/galaxy.git
</code></pre>

<ul>
<li>Start GALAXY</li>
</ul>
<pre><code>cd galaxy
sh run.sh
</code></pre>

<p><em>Note that when you are starting galaxy for the first time, it takes some time to install required internal dependencies and setup its internal database. Once its gone through it, you should be able to see the start up page.</em></p>
<ul>
<li>Congratulations you have successfully installed GALAXY on your local machine.</li>
</ul>
<table>
<thead>
<tr>
<th>Useful resources &amp; tutorials</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://galaxyproject.org/admin/get-galaxy/">Get galaxy</a></td>
</tr>
<tr>
<td><a href="https://galaxyproject.org/learn/">Learn galaxy</a></td>
</tr>
<tr>
<td><a href="https://github.com/galaxyproject/dagobah-training">Dagobah training</a></td>
</tr>
</tbody>
</table>
<hr />
<h2 id="configuring-galaxy">Configuring Galaxy<a class="headerlink" href="#configuring-galaxy" title="Permanent link">#</a></h2>
<p><strong>Setting up an Admin</strong></p>
<p><code>galaxy.ini</code> file contains most of the configurations to your local galaxy. It has some predefined defaults which you might want to re-think before changing anything.</p>
<p><em>We will be using <code>cegr@psu.edu</code> as the default admin, so that it can be used to integrate with PEGR in the PEGR tutorial, where we use our local galaxy to send out information to PEGR</em></p>
<ul>
<li>Make sure your Galaxy is not online, before making any changes to configuration.</li>
<li>Open your galaxy folder in <code>Finder</code> on your mac. you should see a <code>config/</code> folder.</li>
<li>Inside the <code>config/</code>, you will find a <code>galaxy.ini.sample</code> file.</li>
<li>Copy the <code>galaxy.ini.sample</code> within the same folder and rename the copied file to <code>galaxy.ini</code></li>
<li>Open the <code>galaxy.ini</code> in a text editor of your choice.</li>
<li>Search for the line that starts with <code>admin_users</code> and add <code>cegr@psu.edu</code></li>
</ul>
<p><img alt="Galaxy Admin config Image" src="../image/localgalaxy_23.png" /></p>
<p><em>Above image shows the change. make sure you have edited <code>~/Desktop/galaxy/config/galaxy.ini</code></em></p>
<ul>
<li>Start your Galaxy now, <code>sh run.sh</code></li>
<li>Click on <code>User</code> menu and then click <code>register</code></li>
<li>You should see a registration page as below</li>
</ul>
<p><img alt="Galaxy register page" src="../image/register.png" /></p>
<ul>
<li>Enter <code>cegr@psu.edu</code> as the email address and choose a <code>password</code>, <code>public name</code> of your choice.</li>
<li>Once you login, you should now have the <code>Admin</code> menu show up on the menu bar on the top.</li>
</ul>
<p><img alt="Galaxy Admin option" src="../image/adminmenu.png" /></p>
<ul>
<li>When you click on the <code>Admin</code> tab, you should see the below page.</li>
</ul>
<p><img alt="Galaxy Admin page" src="../image/adminpage.png" /></p>
<hr />
<h2 id="adding-custom-genomes">Adding Custom Genomes<a class="headerlink" href="#adding-custom-genomes" title="Permanent link">#</a></h2>
<p><em><code>sacCer3_cegr</code> is the customized yeast genome we are using within the lab. Though the differences are few (to the best of my knowledge), but are very important to keep in mind while performing general data analysis. This genome deviates from the UCSC recommendations</em></p>
<p><em><code>sacCer3_cegr</code> contains <code>2-micron</code> regions &amp; chromosome naming is using <code>decimal number</code> instead of <code>roman numerals.</code> This causes some disadvantages to use tools like bedGraphToBigWig, etc.</em></p>
<ul>
<li>Click on <code>Admin</code> tab, then under <code>Tools and Tool Shed</code> section, click on <code>Search Tool Shed</code></li>
</ul>
<p><img alt="Galaxy ToolShed" src="../image/galaxy_toolshed.png" /></p>
<ul>
<li>Click on <code>Galaxy Main Tool Shed</code></li>
</ul>
<p><img alt="Galaxy ToolShed Categories" src="../image/toolshed_categories.png" /></p>
<ul>
<li>Search &amp; Install below tools. you can copy and paste below tool names into the search box.</li>
</ul>
<table>
<thead>
<tr>
<th>Tool Name</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>data_manager_bwa_mem_index_builder</code></td>
</tr>
<tr>
<td><code>data_manager_fetch_genome_dbkeys_all_fasta</code></td>
</tr>
<tr>
<td><code>data_manager_sam_fasta_index_builder</code></td>
</tr>
<tr>
<td><code>data_manager_twobit_builder</code></td>
</tr>
</tbody>
</table>
<ul>
<li>Below images previews the steps for installing a tool.</li>
</ul>
<p><img alt="Tool Install ex1" src="../image/install_ex1.png" /></p>
<p><img alt="Tool Install ex2" src="../image/install_ex2.png" /></p>
<p><img alt="Tool Install ex3" src="../image/install_ex3.png" /></p>
<ul>
<li>Once you have installed all the above tools, You can verify the installation at <code>Admin &gt; Tools and Tool shed &gt; Manage installed tools</code></li>
</ul>
<p><img alt="Manage installed tools" src="../image/localgalaxy_1.png" /></p>
<ul>
<li>Download the <code>sacCer3_cegr</code> genome from <a href="../image/data/sacCer3_cegr.fa">here</a></li>
<li>Upload the file you downloaded above into galaxy, using the <code>upload button</code> located on the tools menu, as shown in the image below.</li>
</ul>
<p><img alt="Upload button location" src="../image/upload_button.png" /></p>
<ul>
<li>Once you have uploaded, you should see the file appear in the “history pane” on your right.</li>
<li>Go to <code>Admin</code> tab, under <code>Data</code> section, Click on <code>Local data</code> to get <code>Data manager</code></li>
</ul>
<p><img alt="Data Manager" src="../image/localgalaxy_2.png" /></p>
<ul>
<li>We need to run below tools one after the other in the exact order mentioned below:</li>
</ul>
<table>
<thead>
<tr>
<th>Tool</th>
<th>Order</th>
</tr>
</thead>
<tbody>
<tr>
<td>Create DBkey and reference geneome</td>
<td>#1</td>
</tr>
<tr>
<td>TwoBit</td>
<td>#2</td>
</tr>
<tr>
<td>BWA-MEM</td>
<td>#3</td>
</tr>
<tr>
<td>SAM Fasta</td>
<td>#4</td>
</tr>
</tbody>
</table>
<p><em>All these tools are available from the <code>Admin &gt; Data &gt; Local data</code> section. Below are images for step-by-step execution of above tools in the same order. use them to fill out any default information that is required and follow along</em></p>
<ul>
<li>You can specify sequence name to be <code>sacCer3_cegr</code> and leave everything as default in all the tools.</li>
</ul>
<p><img alt="Step 1" src="../image/localgalaxy_3.png" />
<img alt="Step 2" src="../image/localgalaxy_4.png" />
<img alt="Step 3" src="../image/localgalaxy_5.png" />
<img alt="Step 4" src="../image/localgalaxy_6.png" />
<img alt="Step 5" src="../image/localgalaxy_7.png" /></p>
<ul>
<li>Once you have run all the tools, you need to check couple of things that populate in the internal database of galaxy. You can check that information from your <code>Admin</code> page.</li>
<li>Go to <code>Admin &gt; Data &gt; Local data</code> section, under <code>View Tool Data Table Entries</code>. Click on <code>__dbkeys__</code> you should see something like below.</li>
</ul>
<p><img alt="viewtools data table entries" src="../image/localgalaxy_11.png" /></p>
<p><img alt="Step 6" src="../image/localgalaxy_8.png" /></p>
<ul>
<li>Similarly check <code>all_fasta</code>,<code>twobit</code>, <code>bwa_mem_indexes</code>. All of them should contain an entry for <code>sacCer3_cegr</code>. Path could be different in your case.</li>
</ul>
<p><img alt="Step 7" src="../image/localgalaxy_9.png" />
<img alt="Step 8" src="../image/localgalaxy_10.png" />
<img alt="Step 9" src="../image/localgalaxy_12.png" /></p>
<ul>
<li>If your able to see similar results as above images. <code>Congratulations!</code> you have successfully added a custom genome build into your galaxy.</li>
</ul>
<hr />
<h2 id="importing-chip-exo-workflow">Importing ChIP-exo Workflow<a class="headerlink" href="#importing-chip-exo-workflow" title="Permanent link">#</a></h2>
<p><em>We will install the core-sequencing workflow that the lab uses to analyze all the samples that are sequenced. This pipeline is run to create BAM files, peak calling using genetrack and MEME motif analysis.</em></p>
<ul>
<li>Download the workflow file <a href="../image/data/Galaxy-Workflow-paired_002.ga">here.</a></li>
<li>Once you have downloaded the workflow. You can <code>import</code> it into your local galaxy from the <code>Workflow</code> tab using the <code>upload or import workflow</code> button located beside the search bar. <em>(see image below).</em></li>
</ul>
<p><img alt="Workflow upload" src="../image/localgalaxy_16.png" /></p>
<p><img alt="Workflow import menu" src="../image/localgalaxy_17.png" /></p>
<ul>
<li>Once you have selected the workflow file and clicked <code>import</code>. You might see some errors such as below. Nothing to worry, the error messages is caused by tools that are not yet installed &amp; are important for the workflow to run in your galaxy.</li>
</ul>
<p><img alt="Workflow import errors" src="../image/localgalaxy_18.png" /></p>
<ul>
<li>Click on <code>edit</code> option under the workflow drop-down menu. To find out the missing tools.</li>
<li>You need to install each tool manually from toolshed. Go to <code>Admin &gt; Tools and Tool Shed &gt; Search toolShed</code> to search and install each tool that is missing.</li>
</ul>
<p><em>Few tools have their toolnames in the workflow that end with <code>output_statistics</code>. These are the tools that are not available on <code>Galaxy toolshed</code> and need to be side-loaded separately, which we will do in the next section. so for now, you can ignore installing these tools and their errors.</em></p>
<hr />
<h2 id="integrating-cegr-output_statistics">Integrating CEGR <em><code>output_statistics</code></em><a class="headerlink" href="#integrating-cegr-output_statistics" title="Permanent link">#</a></h2>
<p><em>This section is similar to adding custom tools into Galaxy, here is a  (<a href="https://galaxyproject.org/admin/tools/add-tool-tutorial/">tutorial</a>). <code>cegr-galaxy</code> repo contains other important scripts that are used to run the core-sequencing pipeline on production galaxy. The repo has a <code>README</code> file detailing the usage of each script.</em></p>
<ul>
<li>
<p>Clone the repository containing the CEGR tools from <a href="https://github.com/seqcode/cegr-galaxy">seqcode/cegr-galaxy</a></p>
<ul>
<li><code>git clone https://github.com/seqcode/cegr-galaxy.git</code></li>
</ul>
</li>
<li>
<p>Copy the entire <code>cegr_statistics</code> folder to this location <code>galaxy/tools/</code> within your local galaxy.</p>
</li>
<li>Open <code>galaxy/config/tool_conf.xml</code> in a text editor of your choice.</li>
</ul>
<p><em>If the above file doesn't exist, there should be a file in the same config directory called <code>tool_conf.xml.main</code>, copy and rename the file to <code>tool_conf.xml</code></em></p>
<ul>
<li>Add below lines at the end of file, within the <code>&lt;/toolbox&gt;</code> tag.</li>
</ul>
<pre><code>&lt;section id=&quot;cegr_tools&quot; name=&quot;CEGR&quot;&gt;
    &lt;tool file=&quot;cegr_statistics/bam_to_scidx_output_stats.xml&quot; /&gt;
    &lt;tool file=&quot;cegr_statistics/bedtools_intersectbed_output_stats.xml&quot; /&gt;
    &lt;tool file=&quot;cegr_statistics/bwa_mem_output_stats_single.xml&quot; /&gt;
    &lt;tool file=&quot;cegr_statistics/cwpair2_output_stats.xml&quot; /&gt;
    &lt;tool file=&quot;cegr_statistics/extract_genomic_dna_output_stats.xml&quot; /&gt;
    &lt;tool file=&quot;cegr_statistics/extract_genomic_dna_output_stats2.xml&quot; /&gt;
    &lt;tool file=&quot;cegr_statistics/extract_genomic_dna_output_stats3.xml&quot; /&gt;
    &lt;tool file=&quot;cegr_statistics/fasta_nucleotide_color_plot_output_stats.xml&quot; /&gt;
    &lt;tool file=&quot;cegr_statistics/fastqc_output_stats.xml&quot; /&gt;
    &lt;tool file=&quot;cegr_statistics/fastqc_output_stats2.xml&quot; /&gt;
    &lt;tool file=&quot;cegr_statistics/genetrack_output_stats.xml&quot; /&gt;
    &lt;tool file=&quot;cegr_statistics/input_dataset_r1_output_stats.xml&quot; /&gt;
    &lt;tool file=&quot;cegr_statistics/input_dataset_r2_output_stats.xml&quot; /&gt;
    &lt;tool file=&quot;cegr_statistics/mark_duplicates_bam_output_stats.xml&quot; /&gt;
    &lt;tool file=&quot;cegr_statistics/meme_fimo_output_stats.xml&quot; /&gt;
    &lt;tool file=&quot;cegr_statistics/meme_meme_output_stats.xml&quot; /&gt;
    &lt;tool file=&quot;cegr_statistics/pe_histogram_output_stats.xml&quot; /&gt;
    &lt;tool file=&quot;cegr_statistics/repeatmasker_wrapper_output_stats.xml&quot; /&gt;
    &lt;tool file=&quot;cegr_statistics/repeatmasker_wrapper_output_stats2.xml&quot; /&gt;
    &lt;tool file=&quot;cegr_statistics/samtool_filter2_output_stats.xml&quot; /&gt;
    &lt;tool file=&quot;cegr_statistics/tag_pileup_frequency_output_stats.xml&quot; /&gt;
  &lt;/section&gt;

</code></pre>

<p><em>The above lines informs GALAXY, where it can find the tools and corresponding toolwrappers</em></p>
<ul>
<li>The file <code>galaxy/config/tool_config.xml</code> should look something like below:</li>
</ul>
<p><img alt="Adding CEGR tools" src="../image/addingcegrtools.png" /></p>
<ul>
<li>Save the file and restart Galaxy. You should now see these tools appear under <code>Tools</code> menu within galaxy's <code>Analyze Data</code> tab similar to below.</li>
</ul>
<p><img alt="CEGR tools view" src="../image/cegr_tools.png" /></p>
<ul>
<li><code>Congratulations!</code> you have successfully installed <code>output_statistics</code> tools into your galaxy.</li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../planemo/" class="btn btn-neutral float-right" title="Planemo">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href=".." class="btn btn-neutral" title="Home"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/CEGRcode/labtutorial/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href=".." style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../planemo/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
