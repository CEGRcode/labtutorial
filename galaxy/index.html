<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Galaxy - PughLab-guides</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Galaxy";
    var mkdocs_page_input_path = "galaxy.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> PughLab-guides</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Home</a>
	    </li>
          
            <li class="toctree-l1 current">
		
    <a class="current" href="./">Galaxy</a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#pre-install">Pre-Install</a></li>
    

    <li class="toctree-l2"><a href="#install">Install</a></li>
    

    <li class="toctree-l2"><a href="#install-saccer3_cegr-genome-build">Install sacCer3_cegr Genome build</a></li>
    

    <li class="toctree-l2"><a href="#install-the-galaxy-chip-exo-workflow">Install the Galaxy / ChIP-exo Workflow</a></li>
    

    <li class="toctree-l2"><a href="#install-repeatmasker-on-mac-optional">Install RepeatMasker on mac (optional)</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#pre-install_1">Pre-Install</a></li>
        
        </ul>
    

    <li class="toctree-l2"><a href="#add-the-cegr-galaxy-output-statistics-for-the-core-pipeline">Add the cegr galaxy output statistics for the core pipeline.</a></li>
    

    <li class="toctree-l2"><a href="#add-workflow-id-into-your-local-pegr-db">Add workflow id into your Local PEGR DB</a></li>
    

    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../planemo/">Planemo</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../pegr/">PEGR</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../grails/">Grails</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../debug/">Debug</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../FAQ/">FAQ</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">PughLab-guides</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Galaxy</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/CEGRcode/labtutorial/edit/master/docs/galaxy.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="pre-install">Pre-Install<a class="headerlink" href="#pre-install" title="Permanent link">#</a></h2>
<p>Install samtools (locally) on your machine if it is not already installed.</p>
<ul>
<li><code>$ brew install samtools</code> # (mac)</li>
<li><code>http://samtools.sourceforge.net/-Install</code> # (other)</li>
</ul>
<p>Install yarn on your machine, if not already installed.</p>
<ul>
<li><code>$ brew install yarn</code> # (mac)</li>
<li><code>https://yarnpkg.com/en/docs/install</code> # (other)</li>
</ul>
<h2 id="install">Install<a class="headerlink" href="#install" title="Permanent link">#</a></h2>
<ul>
<li>Go to the tutorial link:  <a href="https://galaxyproject.org/admin/get-galaxy/">galaxyproject.org/admin/#get-galaxy</a></li>
<li>Clone the galaxy somewhere lower in the directory structure to avoid conda issues and problems. BEST CHOICE: clone it to your ~/Desktop</li>
<li><code>$ git clone -b release_17.09 https://github.com/galaxyproject/galaxy.git</code></li>
<li><code>$ git branch –a</code> # optional</li>
<li>
<p><code>$ git checkout master</code> # optional</p>
</li>
<li>
<p>Go into the directory “galaxy”</p>
</li>
<li><code>sh run.sh</code> # run galaxy server</li>
<li>Couple of dependencies are installed and you should see the galaxy running at localhost:8080</li>
</ul>
<p>Basic starting point tutorials:</p>
<ul>
<li><a href="https://galaxyproject.org/learn/">galaxyproject.org/#learn</a></li>
<li><a href="https://github.com/galaxyproject/dagobah-training">github.com/galaxyproject/#dagobah-training</a></li>
</ul>
<h2 id="install-saccer3_cegr-genome-build">Install sacCer3_cegr Genome build<a class="headerlink" href="#install-saccer3_cegr-genome-build" title="Permanent link">#</a></h2>
<ul>
<li>Run the galaxy on http://127.0.0.1:8080.</li>
<li>
<p>Register by click on User -&gt; register</p>
</li>
<li>
<p>Use the following credentials</p>
<ul>
<li><code>Username: cegr@psu.edu # username should be same to make the api calls work</code></li>
<li><code>Password: your_password # create a password of your choice</code></li>
</ul>
</li>
<li>
<p>Create a copy of “galaxy.ini.sample” in Config folder and rename it to “galaxy.ini”.</p>
</li>
<li>Open the galaxy.ini file and search for “admin_users” and add the username to have admin access.</li>
</ul>
<p>Install the below tools from your admin toolshed. (usually install those with the “Owner” being “iuc” or “devteam”).</p>
<pre><code>data_manager_bwa_mem_index_builderodata_manager_fetch_genome_dbkeys_all_fastaodata_manager_sam_fasta_index_builderodata_manager_twobit_builder
</code></pre>
<p>Upload the “sacCer3_cegr. fa” fasta file into the galaxy using the “upload button” on the left pane top right corner.
(available in the data folder, provided along with this documentation). Once you have uploaded, you should see the file appear in the “history pane” on your right.</p>
<p>Go to Admin portal. Under the “data” section. Click on localdata.
- You need to run the following “data managers tools” that we just installed in the exact order as below:
* <code>CreateDBkey and reference geneomeoTwoBitoBWA-MEM</code>
* <code>SAM Fasta</code></p>
<ul>
<li>Below is a screenshot for each of the steps, in the same order of execution.</li>
<li>Once you click on the “Create DBkey and Reference Genome”, fill out the information as below and click “Execute”.</li>
<li>You can specify sequence name to be “SacCer3_cegr” and leave everything as default in all the tools.</li>
</ul>
<p>Once you have run all the tools, you need to check couple of things populate in the internal databases of galaxy.</p>
<ul>
<li>Go to Admin -&gt; View Tool Data Table Entries -&gt; <strong>dbkeys</strong></li>
<li>Similarly check “all_fasta”,”twobit”,”bwa_mem_indexes” (all the ones that are bold in the below image, should contain an entry for sacCer3_cegr)</li>
</ul>
<h2 id="install-the-galaxy-chip-exo-workflow">Install the Galaxy / ChIP-exo Workflow<a class="headerlink" href="#install-the-galaxy-chip-exo-workflow" title="Permanent link">#</a></h2>
<ul>
<li>Go to https://chipexo-gw.aci.ics.psu.edu/,</li>
</ul>
<p>Log in with the correct credentials
* <code>Username: username</code>
* <code>Password: password</code>
- You should see the below page.</p>
<h2 id="install-repeatmasker-on-mac-optional">Install RepeatMasker on mac (optional)<a class="headerlink" href="#install-repeatmasker-on-mac-optional" title="Permanent link">#</a></h2>
<ul>
<li>This is not required for YEPQC pipeline)</li>
<li>Go to the website http://www.repeatmasker.org/RMDownload.html</li>
<li>You need to install the prerequisites first.</li>
</ul>
<h3 id="pre-install_1">Pre-Install<a class="headerlink" href="#pre-install_1" title="Permanent link">#</a></h3>
<p>Install RMBlast (sequence Search engine): <a href="http://www.repeatmasker.org/RMBlast.html">RMBlast</a></p>
<p>You can just download all the binaries from these two locations based on your machine (mac, linux)
* <code>ftp://ftp.ncbi.nlm.nih.gov/blast/executables/rmblast/2.2.28/</code>
* <code>ftp://ftp.ncbi.nlm.nih.gov/blast/executables/blast+/2.2.28/</code></p>
<ul>
<li>
<p>extract them and copy all the binaries into “/usr/local/bin/” so that all users can use them.</p>
</li>
<li>
<p>Check whether you have “rmblastn“ binary in /usr/local/bin/. If you don’t then follow the steps in the RMBLAST installation website above.</p>
</li>
</ul>
<p>Install TFR: <a href="http://tandem.bu.edu/trf/trf.download.html">download</a></p>
<ul>
<li>Now follow the rest of the instructions on http://www.repeatmasker.org/RMDownload.html</li>
</ul>
<p>Under the Installation section:</p>
<pre><code>Download the RepeatMasker.tar.gz
Uncompress and copy it to /usr/local/
cd /usr/local/RepeatMasker and sudo perl ./configure
It prompts for various paths for the executables which we just installed.
Specify the paths in correctly and add the path to RepeatMasker to your $PATH
</code></pre>
<h2 id="add-the-cegr-galaxy-output-statistics-for-the-core-pipeline">Add the cegr galaxy output statistics for the core pipeline.<a class="headerlink" href="#add-the-cegr-galaxy-output-statistics-for-the-core-pipeline" title="Permanent link">#</a></h2>
<ul>
<li><a href="https://galaxyproject.org/admin/tools/add-tool-tutorial/">Reference</a> to add new tools into galaxy.</li>
<li>Download the tools from <a href="https://github.com/seqcode/cegr-galaxy.git-extract">seqcode</a> and copy the cegr_statistics folder into your “tools” folder in galaxy.</li>
</ul>
<p>Please remember that below lines make your galaxy run on port 8090 and local pegr run on port 8080.</p>
<ul>
<li>Configure the port for galaxy in “galaxy.ini” file.</li>
<li>You need to generate an apikey in your local galaxy so that it can communicate with the local PEGR.</li>
<li>On “Admin/UserManagement” click on “API keys”. Click on “Generate a new key now”. Use that key in the below steps. (don't generate keys for the same user twice, it can lead to errors.)</li>
<li>create a copy of “stats_config.ini.sample” and rename it to “cegr_config.ini.sample”</li>
<li>
<p>add the below lines into the file.</p>
</li>
<li>
<p>Now you need to make galaxy know how to use these tools.</p>
</li>
<li>Go to your “config” folder and make a copy of “tools_conf.xml.main” and rename it to “tools_conf.xml”</li>
<li>Add below lines at the end of the file within the </toolbox></li>
</ul>
<p>Save and restart galaxy.</p>
<ul>
<li>You can edit the pipeline to remove “Repeat masker” in the paired_002” workflow.</li>
<li>Below images show removal of “Repeat masker” and rearranging the workflow.</li>
</ul>
<h2 id="add-workflow-id-into-your-local-pegr-db">Add workflow id into your Local PEGR DB<a class="headerlink" href="#add-workflow-id-into-your-local-pegr-db" title="Permanent link">#</a></h2>
<p>Each workflow in galaxy has a unique id that is assigned internally. We use bioblend framework (python) to access galaxy and retrieve your workflow id.</p>
<p><a href="https://bioblend.readthedocs.io/en/latest/api_docs/galaxy/docs.html">Documentation</a>. You can use the “getWorkflowid.py” python script to get the workflow id.</p>
<p>Make sure you replace your galaxy instance url and apikey from your local instance.(script is available in the data folder, provided along with this documentation). Make sure that your galaxy is running before you use the script.</p>
<ul>
<li>Successful output:</li>
</ul>
<p>CONGRATULATIONS, YOU HAVE SUCCESSFULLY SET UP THE LOCAL GALAXY!</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../planemo/" class="btn btn-neutral float-right" title="Planemo">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href=".." class="btn btn-neutral" title="Home"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/CEGRcode/labtutorial/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href=".." style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../planemo/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
